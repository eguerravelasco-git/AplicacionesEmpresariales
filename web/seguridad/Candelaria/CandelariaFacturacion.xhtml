<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>
            <ui:define name="Empleado">FACTURACION</ui:define>
        </title>
    </h:head>
    <h:body>
        <ui:composition template="../../templates/plantillaInternaCenter.xhtml">
            <ui:define name="top">Modulo de Facturación </ui:define>
            <ui:define name="contenido" >
                <p:growl id="mensajes" autoUpdate="true" showDetail="true"/>
                <h:form id="frmfacturacion" >
                    <p:ajaxStatus onstart="dlgStatus.show();" oncomplete="dlgStatus.hide();"/>
                    <p:panel id="pnlFormulario"  style="text-align: center" >
                        <p:panel id="pnlFacturacion">

                            <p:dataTable id="tblHoja" value="#{facturaControlador.lstFacturas}" var="factura" rowKey="#{factura.id_factura}" 
                                         selectionMode="single"  selection="#{facturaControlador.facturaSel}" style="text-align: center"> 
                                <p:column headerText="Fecha"  >
                                    <h:outputText value="#{facturaControlador.fechaLetras}" />
                                </p:column>
                                <p:column headerText="Factura" >

                                    <h:outputText value="#{factura.id_factura}" />
                                </p:column>
                            </p:dataTable>

                            <p:panelGrid columns="2" >
                                <p:panelGrid columns="2" >
                                    <!--<f:facet name="header" >
                                        <h:outputText value="Datos Cliente" />
                                    </f:facet>

                                    <h:outputText value="Nombres:" />
                                    <h:outputText value="#{facturaControlador.facturaSel.id_cliente.nombres_cliente} 
                                    #{facturaControlador.facturaSel.id_cliente.apellidos_cliente} " />

                      <h:outputText value="Cédula / R.U.C:" />
                      <h:outputText value="#{detalleFacturaControlador.facturaSel.id_cliente.ruc_cliente}" />

                      <h:outputText value="Dirección:" />
                      <h:outputText value="#{facturaControlador.facturaSel.id_cliente.direccion_cliente}" />-->

                                </p:panelGrid>  
                                <p:panelGrid columns="2" >
                                    <f:facet name="header" >
                                        <h:outputText value="Datos Cliente" />
                                    </f:facet>

                                    <h:outputText value="Nombres:" />
                                    <h:outputText value="#{facturaControlador.facturaSel.id_cliente.nombres_cliente} 
                                                  #{facturaControlador.facturaSel.id_cliente.apellidos_cliente} " />

                                    <h:outputText value="Cédula / R.U.C:" />
                                    <h:outputText value="#{detalleFacturaControlador.facturaSel.id_cliente.ruc_cliente}" />

                                    <h:outputText value="Dirección:" />
                                    <h:outputText value="#{facturaControlador.facturaSel.id_cliente.direccion_cliente}" />

                                </p:panelGrid>
                            </p:panelGrid>

                            <p:commandButton id="btnNuevaFactura" value="Nueva Factura" icon="ui-icon-newwin"
                                             oncomplete="wdlgNuevaFactura.show()" title="Nueva Factura"/>  

                        </p:panel>
                        <!--detalles-->
                        <p:panel id="pnlDetalles">

                            <p:dataTable id="tblDetalles" value="#{detalleFacturaControlador.lstDetalleFactura}" var="detalle" rowKey="#{detalle.id_detalle_factura}" 
                                         selectionMode="single"  selection="#{detalleFacturaControlador.detalleFacturaSel}" style="text-align: center"> 
                                <p:column headerText="Codigo"  >
                                    <h:outputText value="#{detalle.id_producto}" />
                                </p:column>
                                <p:column headerText="Cantidad" >

                                    <h:outputText value="#{detalle.cantidad}" />
                                </p:column>
                                <p:column headerText="Descripcion" >

                                    <h:outputText value="#{detalle.id_producto.id_categoria.nombre_producto}" />
                                </p:column>
                                <p:column headerText="Precio Unitario" >

                                    <h:outputText value="#{detalle.costo_unidad}" />
                                </p:column>

                                <p:column headerText="Total" >

                                    <h:outputText value="#{detalle.valor_total}" />
                                </p:column>

                                <p:column exportable="false">
                                    <p:commandButton id="btnEditarDetalle" icon="ui-icon-pencil"  title="Editar Detalle" 
                                                     oncomplete="wdlgEditarDetalle.show()" 
                                                     process="@this" 
                                                     update=":dlgEditarDetalle, @form">                                   
                                        <f:setPropertyActionListener value="#{detalle}" 
                                                                     target="#{detallesControlador.detalleSel}"/>
                                    </p:commandButton>


                                    <p:commandButton id="btnEliminarDetalle" icon="ui-icon-close"  title="Eliminar Detalle"
                                                     oncomplete="wdlgEliminarDetalle.show()" 
                                                     update=":dlgEliminarDetalle , @form">                                   
                                        <f:setPropertyActionListener value="#{detalle}" 
                                                                     target="#{detallesControlador.detalleSel}"/>
                                    </p:commandButton>
                                </p:column>
                            </p:dataTable>
                            <p:commandButton id="btnNuevoDetalle" value="Nuevo Producto" icon="ui-icon-newwin"
                                             oncomplete="wdlgNuevoDetalle.show()" title="Nueva Factura"/>  

                        </p:panel>
                        <!--findetalles-->

                        <p:fieldset legend="TOTAL" 
                                    style="margin-bottom:40px; min-width:40px;min-height:40px;max-height: 50px;max-width: 150px;"
                                    >
                            <p:outputLabel  value="$"/>
                            <p:outputLabel  value="#{detalleFacturaControlador.totalFactura}"/>

                        </p:fieldset>
                        <p:panelGrid columns="3" style="object-position: center">
                            <p:fieldset legend="SUBTOTAL" 
                                        style="margin-bottom:40px; min-width:40px;min-height:40px;max-height: 50px;max-width: 150px;"
                                        >
                                <p:outputLabel  value="$"/>
                                <p:outputLabel  value="#{detalleFacturaControlador.totalHoja}"/>

                            </p:fieldset>
                            <p:fieldset legend="IMPUESTO 12%" 
                                        style="margin-bottom:40px; min-width:40px;min-height:40px;max-height: 50px;max-width: 150px;"
                                        >
                                <p:outputLabel  value="$"/>
                                <p:outputLabel  value="#{facturaControlador.impuestoFactura}"/>

                            </p:fieldset>

                            <p:fieldset legend="TOTAL" 
                                        style="margin-bottom:40px; min-width:40px;min-height:40px;max-height: 50px;max-width: 150px;"
                                        >
                                <p:outputLabel  value="$"/>
                                <p:outputLabel  value="#{facturaControlador.totalFactura}"/>

                            </p:fieldset>
                        </p:panelGrid>

                        <p:commandButton id="btnGuardarFactura" value="Guardar"  icon="ui-icon-disk"
                                         oncomplete="wdlgGuardarFactura.show()" title="Guardar"
                                         process="@this " 
                                         update=":dlgGuardarFactura, @form"/>
                        <p:commandButton value="Imprimir" id="ajax"  

                                         icon="ui-icon-print">
                        </p:commandButton>



                        <!--   <p:commandButton id="btnGuardarFactura" value="Guardar" title="Guardar" icon="ui-icon-disk"
                                            oncomplete="wdlgGuardarFactura.show()" 
                                            process="@this" 
                                            update=":dlgGuardarFactura, @form">                                   

                           </p:commandButton>
                         <p:commandButton value="Imprimir" id="ajax"  
                                            
                                            icon="ui-icon-print">
                           </p:commandButton>-->




                    </p:panel>


                </h:form>
            </ui:define>

            <ui:define name="dialogos">
                <p:dialog id="dlgNuevaFactura" header="Nueva Factura" widgetVar="wdlgNuevaFactura" 
                          modal="true" closable="false" resizable="false"
                          showEffect="clip" hideEffect="fold"> 

                    <h:form id="frmNuevaFactura">
                        <p:ajaxStatus onstart="dlgStatus.show();" oncomplete="dlgStatus.hide();"/>
                        <p:panelGrid id="pngNuevaFactura" columns="2">

                            <h:outputText value="Fecha:"/>
                            <p:inputText value="#{facturaControlador.fecha_cambiada}" disabled="true"  /> 
                            <h:outputText value="Cliente:"/>
                            <p:selectOneMenu id="cmbCliente" value="#{facturaControlador.valorSSeleccionado}">
                                <f:selectItem itemLabel="Elija un cliente" itemValue="#{null}"/>
                                <f:selectItems value="#{facturaControlador.lstClientes}" var="clientes" 
                                               itemLabel="#{clientes.nombres_cliente} #{clientes.apellidos_cliente}"
                                               itemValue="#{clientes.id_cliente}"/>
                            </p:selectOneMenu>

                        </p:panelGrid>

                        <p:commandButton value="Aceptar" action="#{facturaControlador.insertarFactura()}" 
                                         update=":frmfacturacion:pnlFormulario" />
                        <p:commandButton value="Cancelar" onclick="wdlgNuevaFactura.hide()" type="reset"/>
                    </h:form> 
                </p:dialog>

                <p:dialog id="dlgNuevoDetalle" header="Nuevo Detalle" widgetVar="wdlgNuevoDetalle" 
                          modal="true" closable="false" resizable="false"
                          showEffect="clip" hideEffect="fold" position="center top"> 

                    <h:form id="frmNuevoDetalle">
                        <p:ajaxStatus onstart="dlgStatus.show();" oncomplete="dlgStatus.hide();"/>
                        <p:panelGrid id="pngNuevoDetalle" columns="2">


                            <h:outputText value="Cantidad:"/>
                            <p:spinner  value="#{detalleFacturaControlador.objDetalleFactura.cantidad}" title="ej: 5" 
                                        required="true" requiredMessage="Escoja una Cantidad" />


                            <h:outputText value="Nombre Producto:"/>
                            <p:selectOneMenu id="cmbCategoria" value="#{detalleFacturaControlador.valorDSeleccionado}">
                                <f:selectItem itemLabel="Elija un Producto" itemValue="#{null}"/>
                                <f:selectItems value="#{detalleFacturaControlador.lstProductos}" var="producto" 
                                               itemLabel="#{producto.id_categoria.nombre_producto}" itemValue="#{producto.id_producto}"/>
                            </p:selectOneMenu>
                            <!--</h:panelGrid>-->

                        </p:panelGrid>

                        <p:commandButton  value="Aceptar" action="#{detalleFacturaControlador.insertarDetalleFactura()}" 
                                          update=":@form ,@this">
                        </p:commandButton>
                        <p:commandButton value="Cancelar" onclick="wdlgNuevoDetalle.hide()" type="reset"/>
                    </h:form> 
                </p:dialog> 


                <p:dialog id="dlgEditarDetalle" header="Editar Detalle" widgetVar="wdlgEditarDetalle" 
                          modal="true" 
                          closable="false" resizable="false" showEffect="clip" hideEffect="fold" position="center top" >  
                    <h:form id="frmEditarDetalle" >
                        <p:ajaxStatus onstart="dlgStatus.show();" oncomplete="dlgStatus.hide();" />
                        <p:messages id="messages" autoUpdate="true" />  
                        <p:panelGrid id="pngEditarDetalle" columns="2" >
                            <p:spinner  value="#{detalleFacturaControlador.detalleFacturaSel.cantidad}" title="ej: 5" 
                                        required="true" requiredMessage="Escoja una Cantidad" />                    
                        </p:panelGrid>
                        <p:commandButton value="Aceptar" action="#{detalleFacturaControlador.actualizarDetalleFactura()}" 
                                         update="@form ,@this"/>
                        <p:commandButton value="Cancelar" onclick="wdlgEditarDetalle.hide()" type="reset"/>
                    </h:form> 
                </p:dialog>

                <p:dialog id="dlgEliminarDetalle" header="Eliminar Detalle" widgetVar="wdlgEliminarDetalle" 
                          modal="true" closable="false" resizable="false" showEffect="clip" hideEffect="fold">  
                    <h:form id="frmEliminarDetalle">
                        <p:ajaxStatus onstart="dlgStatus.show();" oncomplete="dlgStatus.hide();"/>
                        <h:outputText value="¿Desea Eliminar...?"/>
                        <p:panelGrid id="pngEliminarDetalle" columns="2">

                            <p:outputLabel value="Cantidad"/>
                            <p:inputText value="#{detalleFacturaControlador.detalleFacturaSel.cantidad}" disabled="true"/>

                            <p:outputLabel value="Descripción"/>
                            <p:inputText value="#{detalleFacturaControlador.detalleFacturaSel.id_producto.id_categoria.nombre_producto}" disabled="true"/>

                            <p:outputLabel value="Precio"/>
                            <p:inputText value="#{detalleFacturaControlador.detalleFacturaSel.id_producto.id_categoria.precio_producto}" disabled="true"/>

                        </p:panelGrid>
                        <p:commandButton value="Aceptar" action="#{detalleFacturaControlador.eliminarDetalleFactura()}" 
                                         update="@form ,@this"/>
                        <p:commandButton value="Cancelar" onclick="wdlgEliminarDetalle.hide()" type="reset"/>
                    </h:form> 
                </p:dialog>

                <p:dialog id="dlgGuardarFactura" header="Guardar Factura" widgetVar="wdlgGuardarFactura" 
                          modal="true" closable="false" resizable="false" showEffect="clip" hideEffect="fold">  
                    <h:form id="frmGuardarFactura">
                        <p:ajaxStatus onstart="dlgStatus.show();" oncomplete="dlgStatus.hide();"/>
                        <h:outputText value="¿Desea Guardar la Factura...?"/>
                        <p:panelGrid id="pngGuardarFactura" columns="2">

                            <p:outputLabel value="Fecha"/>
                            <p:inputText value="#{detalleFacturaControlador.facturaSel.fecha}" disabled="true"/>

                            <p:outputLabel value="Cliente"/>
                            <p:inputText value="#{detalleFacturaControlador.facturaSel.id_cliente.nombres_cliente} #{detalleFacturaControlador.facturaSel.id_cliente.apellidos_cliente}" disabled="true"/>

                            <p:outputLabel value="Total"/>
                            <p:inputText value="#{detalleFacturaControlador.totalHoja}" disabled="true"/>

                        </p:panelGrid>
                        <p:commandButton value="Aceptar" action="#{detalleFacturaControlador.actualizarFactura()}" 
                                         update="@form ,@this"/>
                        <p:commandButton value="Cancelar" onclick="wdlgGuardarFactura.hide()" type="reset"/>
                    </h:form> 
                </p:dialog>

                <p:dialog modal="true" widgetVar="dlgStatus" header="Procesando" draggable="false" closable="false" 
                          resizable="false"> 
                    <p:graphicImage value="/resources/images/ajaxloadingbar.gif" />  
                </p:dialog>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
