<?xml version="1.0" encoding="UTF-8"?>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">
    <h:head>
        <title>
            <ui:define name="Empleado">FACTURACION</ui:define>
        </title>
    </h:head>
    <h:body>
        <ui:composition template="../../templates/plantillaInternaCenter.xhtml">
            <ui:define name="top">Modulo de Facturación </ui:define>
            <ui:define name="contenido">
                <p:growl id="mensajes" autoUpdate="true" showDetail="true"/>
                <h:form id="frmfacturación">
                    <p:ajaxStatus onstart="dlgStatus.show();" oncomplete="dlgStatus.hide();"/>
                    <p:panel id="pnlFormulario"  style="text-align: center" >
                        <p:panel id="pnlFacturacion">
                            <p:dataTable id="tblHoja" value="#{detalleFacturaControlador.facturaUltima}" var="factura" rowKey="#{factura.id_factura}" 
                                         selectionMode="single"  selection="#{detalleFacturaControlador.facturaSel}" style="text-align: center"> 
                                <p:column headerText="Fecha "  >
                                    <h:outputText value="#{factura.fecha}" />
                                </p:column>
                                <p:column headerText="Factura" >

                                    <h:outputText value="#{factura.id_factura}" />
                                </p:column>
                            </p:dataTable>
                            <p:commandButton id="btnNuevaFactura" value="Nueva Factura" icon="ui-icon-newwin"
                                             oncomplete="wdlgNuevaFactura.show()" title="Nueva Factura"/>  

                        </p:panel>
                        <p:panel id="pnlDetalle" >
                            <p:dataTable id="tblDetalles" value="#{detalleFacturaControlador.lstDetalleFactura}" 
                                         var="detalle" 
                                         rows="10" rowKey="#{detalle.id_detalle_factura}" selectionMode="single" 
                                         selection="#{detalleFacturaControlador.detalleFacturaSel}" emptyMessage="No se han ingresado detalles" >

                                <p:column headerText="Cantidad">
                                    <h:outputText value="#{detalle.cantidad}"/>
                                </p:column>

                                <p:column  headerText="Descripción">
                                    <h:outputText value="#{detalle.id_producto.id_categoria.nombre_producto}"/>
                                </p:column>                            

                                <p:column  headerText="Precio">
                                    <h:outputText value="#{detalle.id_producto.id_categoria.precio_producto}"/>
                                </p:column>

                                <p:column exportable="false">
                                    <p:commandButton id="btnEditarDetalle" icon="ui-icon-pencil"  title="Editar Detalle" 
                                                     oncomplete="wdlgEditarDetalle.show()" 
                                                     process="@this" 
                                                     update=":dlgEditarDetalle, @form">                                   
                                        <f:setPropertyActionListener value="#{detalle}" 
                                                                     target="#{detalleFacturaControlador.detalleFacturaSel}"/>
                                    </p:commandButton>


                                    <p:commandButton id="btnEliminarDetalle" icon="ui-icon-close"  title="Eliminar Detalle"
                                                     oncomplete="wdlgEliminarDetalle.show()" 
                                                     update=":dlgEliminarDetalle , @form">                                   
                                        <f:setPropertyActionListener value="#{detalle}" 
                                                                     target="#{detalleFacturaControlador.detalleFacturaSel}"/>
                                    </p:commandButton>
                                </p:column>

                                <f:facet name="footer">  

                                    <p:commandButton id="btnNuevoDetalle" value="Nuevo Detalle" icon="ui-icon-newwin"
                                                     oncomplete="wdlgNuevoDetalle.show()" title="Nuevo Detalle"/>  

                                    <p:fieldset legend="TOTAL" 
                                                style="margin-bottom:40px; min-width:40px;min-height:40px;max-height: 50px;max-width: 150px;"
                                                >
                                        <p:outputLabel  value="$"/>
                                        <p:outputLabel  value="#{detalleFacturaControlador.totalFactura}"/>

                                    </p:fieldset>
                                    <p:panelGrid columns="3" style="object-position: center">
                                        <p:fieldset legend="SUBTOTAL" 
                                                    style="margin-bottom:40px; min-width:40px;min-height:40px;max-height: 50px;max-width: 150px;"
                                                    >
                                            <p:outputLabel  value="$"/>
                                            <p:outputLabel  value="#{detalleFacturaControlador.totalHoja}"/>

                                        </p:fieldset>
                                        <p:fieldset legend="IMPUESTO 12%" 
                                                    style="margin-bottom:40px; min-width:40px;min-height:40px;max-height: 50px;max-width: 150px;"
                                                    >
                                            <p:outputLabel  value="$"/>
                                            <p:outputLabel  value="#{detalleFacturaControlador.impuestoFactura}"/>

                                        </p:fieldset>

                                        <p:fieldset legend="TOTAL" 
                                                    style="margin-bottom:40px; min-width:40px;min-height:40px;max-height: 50px;max-width: 150px;"
                                                    >
                                            <p:outputLabel  value="$"/>
                                            <p:outputLabel  value="#{detalleFacturaControlador.totalFactura}"/>

                                        </p:fieldset>
                                    </p:panelGrid>

                                    <p:commandButton id="btnGuardarFactura" value="Guardar"  icon="ui-icon-disk"
                                                     oncomplete="wdlgGuardarFactura.show()" title="Guardar"
                                                     process="@this " 
                                                     update=":dlgGuardarFactura, @form"/>
                                    <!--<p:commandButton value="Imprimir" id="ajax"  
                                                     
                                                     icon="ui-icon-print">
                                    </p:commandButton>



                                    <p:commandButton id="btnGuardarFactura" value="Guardar" title="Guardar" icon="ui-icon-disk"
                                                     oncomplete="wdlgGuardarFactura.show()" 
                                                     process="@this" 
                                                     update=":dlgGuardarFactura, @form">                                   

                                    </p:commandButton>-->
                                    <!--<p:commandButton value="Imprimir" id="ajax"  
                                                     
                                                     icon="ui-icon-print">
                                    </p:commandButton>-->

                                </f:facet>
                            </p:dataTable>
                        </p:panel> 
                    </p:panel>


                </h:form>
            </ui:define>

            <ui:define name="dialogos">
               <p:dialog id="dlgNuevaFactura" header="Nueva Factura" widgetVar="wdlgNuevaFactura" 
                          modal="true" closable="false" resizable="false"
                          showEffect="clip" hideEffect="fold"> 

                    <h:form id="frmNuevaFactura">
                        <p:ajaxStatus onstart="dlgStatus.show();" oncomplete="dlgStatus.hide();"/>
                        <p:panelGrid id="pngNuevaFactura" columns="2">

                            <h:outputText value="Fecha:"/>
                            <p:inputText value="#{detalleFacturaControlador.fecha_cambiada}" disabled="true"  /> 
                            <h:outputText value="Cliente:"/>
                            <p:selectOneMenu id="cmbCliente" value="#{detalleFacturaControlador.valorSSeleccionado}">
                                        <f:selectItem itemLabel="Elija un cliente" itemValue="#{null}"/>
                                        <f:selectItems value="#{detalleFacturaControlador.lstClientes}" var="clientes" itemLabel="#{clientes.nombres_cliente} #{clientes.apellidos_cliente}"
                                                       itemValue="#{clientes.id_cliente}"/>
                                    </p:selectOneMenu>

                        </p:panelGrid>

                        <p:commandButton value="Aceptar" action="#{detalleFacturaControlador.insertarFactura()}" 
                                         update="@form ,@this" />
                        <p:commandButton value="Cancelar" onclick="wdlgNuevaFactura.hide()" type="reset"/>
                    </h:form> 
                </p:dialog>

                <p:dialog id="dlgNuevoDetalle" header="Nuevo Detalle" widgetVar="wdlgNuevoDetalle" 
                          modal="true" closable="false" resizable="false"
                          showEffect="clip" hideEffect="fold" position="center top"> 

                    <h:form id="frmNuevoDetalle">
                        <p:ajaxStatus onstart="dlgStatus.show();" oncomplete="dlgStatus.hide();"/>
                        <p:panelGrid id="pngNuevoDetalle" columns="1">

                            <p:accordionPanel >
                                <p:tab title="Escoja una Cantitad">
                                    <p:spinner  value="#{detallesControlador.cantidad}" title="ej: 5" 
                                                required="true" requiredMessage="Escoja una Cantidad" />
                                </p:tab>
                                <p:tab title="Escoja un Producto">
                                    <!--<h:panelGrid columns="1" cellpadding="10">-->
                                    <p:dataTable id="tblProductos" value="#{detalleFacturaControlador.lstProductos}" var="producto" rowKey="#{producto.id_producto}" 
                                                 selectionMode="single"  rows="5" paginator="true"
                                                 selection="#{detalleFacturaControlador.productoSel}" style="text-align: center"> 
                                        <p:column  headerText="Trabajo">
                                            <h:outputText value="#{producto.id_categoria.nombre_producto}" />
                                        </p:column>
                                        <p:column   headerText="Precio">
                                            <h:outputText value="#{producto.id_categoria.precio_producto}" />
                                        </p:column>

                                    </p:dataTable>
                                    <!--</h:panelGrid>-->
                                </p:tab>


                            </p:accordionPanel>

                        </p:panelGrid>

                        <p:commandButton  value="Aceptar" action="#{detalleFacturaControlador.insertarDetalleFactura()}" 
                                          update=":@form ,@this">
                        </p:commandButton>
                        <p:commandButton value="Cancelar" onclick="wdlgNuevoDetalle.hide()" type="reset"/>
                    </h:form> 
                </p:dialog> 


                <p:dialog id="dlgEditarDetalle" header="Editar Detalle" widgetVar="wdlgEditarDetalle" 
                          modal="true" 
                          closable="false" resizable="false" showEffect="clip" hideEffect="fold" position="center top" >  
                    <h:form id="frmEditarDetalle" >
                        <p:ajaxStatus onstart="dlgStatus.show();" oncomplete="dlgStatus.hide();" />
                        <p:messages id="messages" autoUpdate="true" />  
                        <p:panelGrid id="pngEditarDetalle" columns="2" >

                            <p:accordionPanel >
                                <p:tab title="Escoja una Cantitad">
                                    <p:spinner  value="#{detalleFacturaControlador.detalleFacturaSel.cantidad}" title="ej: 5" 
                                                required="true" requiredMessage="Escoja una Cantidad" />
                                </p:tab>
                                <p:tab title="Escoja un Producto">
                                    <!--<h:panelGrid columns="1" cellpadding="10">-->
                                    <p:dataTable id="tblServicios" value="#{detalleFacturaControlador.lstProductos}" var="producto" 
                                                 rowKey="#{producto.id_producto}" 
                                                 selectionMode="single"  rows="5" paginator="true"
                                                 selection="#{detalleFacturaControlador.productoSel}" style="text-align: center"> 
                                        <p:column  headerText="Trabajo">
                                            <h:outputText value="#{producto.id_categoria.nombre_producto}" />
                                        </p:column>
                                        <p:column   headerText="Precio">
                                            <h:outputText value="#{producto.id_categoria.precio_producto}" />
                                        </p:column>

                                    </p:dataTable>
                                    <!--</h:panelGrid>-->
                                </p:tab>


                            </p:accordionPanel>


                        </p:panelGrid>
                        <p:commandButton value="Aceptar" action="#{detalleFacturaControlador.actualizarDetalleFactura()}" 
                                         update="@form ,@this"/>
                        <p:commandButton value="Cancelar" onclick="wdlgEditarDetalle.hide()" type="reset"/>
                    </h:form> 
                </p:dialog>

                <p:dialog id="dlgEliminarDetalle" header="Eliminar Detalle" widgetVar="wdlgEliminarDetalle" 
                          modal="true" closable="false" resizable="false" showEffect="clip" hideEffect="fold">  
                    <h:form id="frmEliminarDetalle">
                        <p:ajaxStatus onstart="dlgStatus.show();" oncomplete="dlgStatus.hide();"/>
                        <h:outputText value="¿Desea Eliminar...?"/>
                        <p:panelGrid id="pngEliminarDetalle" columns="2">

                            <p:outputLabel value="Cantidad"/>
                            <p:inputText value="#{detalleFacturaControlador.detalleFacturaSel.cantidad}" disabled="true"/>

                            <p:outputLabel value="Descripción"/>
                            <p:inputText value="#{detalleFacturaControlador.detalleFacturaSel.id_producto.id_categoria.nombre_producto}" disabled="true"/>

                            <p:outputLabel value="Precio"/>
                            <p:inputText value="#{detalleFacturaControlador.detalleFacturaSel.id_producto.id_categoria.precio_producto}" disabled="true"/>

                        </p:panelGrid>
                        <p:commandButton value="Aceptar" action="#{detalleFacturaControlador.eliminarDetalleFactura()}" 
                                         update="@form ,@this"/>
                        <p:commandButton value="Cancelar" onclick="wdlgEliminarDetalle.hide()" type="reset"/>
                    </h:form> 
                </p:dialog>

                <p:dialog id="dlgGuardarFactura" header="Guardar Factura" widgetVar="wdlgGuardarFactura" 
                          modal="true" closable="false" resizable="false" showEffect="clip" hideEffect="fold">  
                    <h:form id="frmGuardarFactura">
                        <p:ajaxStatus onstart="dlgStatus.show();" oncomplete="dlgStatus.hide();"/>
                        <h:outputText value="¿Desea Guardar la Factura...?"/>
                        <p:panelGrid id="pngGuardarFactura" columns="2">

                            <p:outputLabel value="Fecha"/>
                            <p:inputText value="#{detalleFacturaControlador.facturaSel.fecha}" disabled="true"/>

                            <p:outputLabel value="Cliente"/>
                            <p:inputText value="#{detalleFacturaControlador.facturaSel.id_cliente.nombres_cliente} #{detalleFacturaControlador.facturaSel.id_cliente.apellidos_cliente}" disabled="true"/>

                            <p:outputLabel value="Total"/>
                            <p:inputText value="#{detalleFacturaControlador.totalHoja}" disabled="true"/>

                        </p:panelGrid>
                        <p:commandButton value="Aceptar" action="#{detalleFacturaControlador.actualizarFactura()}" 
                                         update="@form ,@this"/>
                        <p:commandButton value="Cancelar" onclick="wdlgGuardarFactura.hide()" type="reset"/>
                    </h:form> 
                </p:dialog>

                    <p:dialog modal="true" widgetVar="dlgStatus" header="Procesando" draggable="false" closable="false" 
                              resizable="false"> 
                        <p:graphicImage value="/resources/images/ajaxloadingbar.gif" />  
                    </p:dialog>
            </ui:define>
        </ui:composition>
    </h:body>
</html>
